<!-- 
 * Generated by Blade.
 * 2016-06-13 10:43:54
 -->
@layout("/common/_curd/_container.html"){
	<form data-url="${basePath}/${code}/save" method="post" class="form-horizontal" role="form">
			<div class="form-group">
				@ var _table="tb_daily";
				@ var _col=[
				@ 			  {name:"活动类型",index:"articleType", type:"select_926", newline:true,length:8},
				@  			  {name:"封面",index:"licenseImage", type:"imgupload",newline:true,length:8,returnType:"id"},
				@		      {name:"标题",index:"title", type:"text",newline:true,length:8,required:"required"}
				@		   ];
				@
				@ include("/common/_curd/_add.html", {"col":_col, "table":_table}){}
			</div>
			<div class="form-group activity" style="display: none">
				@ var _table2="tb_daily";
				@ var _col2=[
				@ 			  {name:"选择活动开始时间",index:"startTime", type:"laydate",format:"YYYY-MM-DD hh:mm:ss", newline:true,length:3},
				@			  {name:"选择活动结束时间",index:"endTime", type:"laydate",format:"YYYY-MM-DD hh:mm:ss", newline:false,length:3},
				@ 			  {name:"报名人数上限",index:"ceiling", type:"text", newline:true,length:3},
				@			  {name:"报名截止时间",index:"applyEndTime", type:"laydate", newline:false,length:3},
				@             {name:"身份限制",index:"limit", type:"text", newline:true,length:3},
				@			  {name:"费用",index:"cost", type:"text", newline:false,length:3},
				@ 			  {name:"省份",index:"provinceId", type:"text", newline:true,length:3},
				@             {name:"城市",index:"cityId", type:"text", newline:false,length:3},
				@             {name:"地址",index:"cityId", type:"text", newline:true,length:8}
				@		   ];
				@
				@ include("/common/_curd/_add.html", {"col":_col2, "table":_table2}){}
			</div>
			<!-- 表单 -->
			<div class="form-group">
				@ var _table3="tb_daily";
				@ var _col3=[
				@			  {name:"内容",index:"content", type:"kindeditor",newline:true,length:8,required:"required"}
				@		   ];
				@
				@ include("/common/_curd/_add.html", {"col":_col3, "table":_table3}){}
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label no-padding-right">日报</label>
				<div class="col-sm-3">
					<input type="checkbox" id="isDaily" style="margin-top: 3px">
				</div>

				<label class="col-sm-2 control-label no-padding-right">对组织感兴趣的人</label>
				<div class="col-sm-3">
					<input type="checkbox" id="interest" style="margin-top: 3px">
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label no-padding-right" >选择杂志</label>

				<div class="col-sm-3">
					<blade:select type="dept"  name="TFW_USER.DEPTID" value="0" />
					<input type="button" id="add" class="button" style="margin-top: 3px" onclick="grouping(this)" value="添加">
				</div>
			</div>

			<div class="form-group" >
				<label class="col-sm-2 control-label no-padding-right">分组字段</label>
				<div class="col-sm-3" id="group" >
				</div>
			</div>

			<!-- 按钮 -->
			<div class="clearfix form-actions center" style="margin-top:15px;margin-bottom:5px;">
				<div class="col-md-offset-1 col-md-10">
					<button class="btn btn-info" type="submit" id="btn_publish">
						<i class="ace-icon fa fa-check bigger-110"></i>
						发布
					</button>
					&nbsp; &nbsp; &nbsp;
					<button class="btn" type="button" id="btn_close">
						<i class="ace-icon fa fa-close bigger-110"></i>
						关闭
					</button>
				</div>
			</div>
	</form>
	<script type="text/javascript">
		$(function() {
			$("#_articleType").click(function() {
				var _selectVar = $(this).val();
				console.log(_selectVar);
				if (_selectVar == 3) {
					$(".activity").show();
				}
				else {
					$(".activity").hide();
				}
			});
		});

		function grouping(data){
			var val = $(data).parent().find("input").eq(0).val();
			var index = false;
			var i=0;
			if(val==""){
				layer_alert("不能为空","error");
				return;
			}
			$("#group div").each(function(){
				i++;
				var value = $(this).find("input[name='Classification.classification']").val();
				if(value==val){
					index=true;
				}
			});
			if(i==10){
				layer_alert("最多只能有十个标签","error");
				return;
			}
			if(index){
				layer_alert("已有相同标签","error");
				return;
			}

			var html = "";
			html += "<div class='col-sm-3 input-group' style='float:left;background: #666;color: white;position: relative;font-size: 15px;width: auto;text-indent: 10px;margin:0 5px 5px 0'>" + val;
			html += "	<span class='o_close' data-percent='' onclick='doDelete(this)' style='cursor: pointer;color: #ccc;margin: 0 5px auto'>x</span>	";
			html += "	<input type='hidden' name='Classification.classification' value='" + val + "'> 	";
			html += "	<input type='hidden' name='Classification.id' value=''> 	";
			html += "</div>   ";
			$(data).parent().find("input").eq(0).val("");
			$("#group").append(html);

		}

		function doDelete(btn) {
			var id = $(btn).parent().find("input[name='Classification.id']").val();
			if(id!=""){
				$.post("${basePath}/${code}/classification_del", { id: id }, function (data) {
					console.log("code=====");
					console.log(data.code);
					console.log("data=====");
					console.log(data);
					if (data.code === 0) {
						$(btn).parent().remove();
						layer_alert(data.message, "success");
					}
					else {
						layer_post(data);
					}
				}, "json");
			}else{
				$(btn).parent().remove();
			}
		}

	</script>
@}
