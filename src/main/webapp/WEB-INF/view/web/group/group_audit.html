@layout("/common/_curd/_container.html"){

<script type="text/javascript">
    var ctx="${basePath}";
    var grid_selector = "#grid-table1";
    var pager_selector = "#grid-pager1";
    var hidden = 1;
    $(function(){
        initGrid();
        initMenuBtn("btns","${code}");
    });

    /**
     *用于执行按钮加载事件结束后操作的ajax请求(否则会导致回调覆盖,也可以使用 async:false)
     */
    function doOther(){
        initZtree();
    }

    function initGrid(){
        var grid_url = ctx+"/${code}/list";//查询列表接口
        var _colnames=[
            "序列",
            "头像",
            "组织ID",
            "名称",
            "组织关键字",
            "创建者",
            "审核者",
            "审核状态",
            "审核状态1",
            "备注",
            "状态改变时间",
            "操作"
        ];
        var _colmodel=[
            {name:"id",index:"id", width:80,hidden:true},
            {name:"avater",index:"avater", width:120},
            {name:"idcard",index:"idcard", width:120},
            {name:"gName",index:"gName", width:120},
            {name:"targat",index:"targat", width:100},
            {name:"createName",index:"createName", width:120},
            {name:"approvalName",index:"approvalName", width:120},
            {name:"auditStatus",index:"auditStatus", width:120},
            {name:"a_status",index:"a_status", width:120,hidden:true},
            {name:"auditComment",index:"auditComment", width:120},
            {name:"updateTime",index:"updateTime", width:120},
            {
                width: 240,
                formatter: function (cellvalue, options, rowObject) {
                    var id = rowObject.id;
                    var status = rowObject.a_status;
                    var agreed = "<button title='通过' class='btn btn-primary btn-circle edit' onclick=\"audit(\'" + id + "\',\'" + 3 + "\')\">" +
                            "<i class='fa fa-circle-o'></i> 通过</button>";

                    var refused = "<button title='否决' class='btn btn-primary btn-circle edit' onclick=\"audit(\'" + id + "\',\'" + 4 + "\')\">" +
                            "<i class='fa fa-circle'></i> 否决</button>";

                    var review = "<button title='申请重审' class='btn btn-primary btn-circle edit' onclick=\"audit(\'" + id + "\',\'" + 2 + "\')\">" +
                            "<i class='fa fa-circle-o'></i> 申请重审</button>";

                    if(status == "4"){
                        return review;
                    }else if(status == "3"){
                        return "<button disabled='disabled'title='通过' class='btn btn-primary btn-circle edit'><i class='fa fa-circle-o'></i> 通过</button>&nbsp;<button disabled='disabled' title='否决' class='btn btn-primary btn-circle edit'><i class='fa fa-circle'></i>否决</button>"
                    }else {
                        return agreed + "&nbsp;" + refused;

                    }

                }
            }
        ];

        jQuery(grid_selector).jqGrid({
            url:grid_url,
//            shrinkToFit:true,//适用于较少字段,响应式
            autowidth : true,
            forceFit : true,
            colNames:_colnames,
            colModel:_colmodel,
            jsonReader:{id:"ID"},
            pager : pager_selector,
            postData: {sort: "id", order: "asc"}
        });

    }

    function audit(id,status){
        $.post("${basePath}/group/audit_status",{id:id , status:status}, function(data){
            if(data.code===0){
                searchGrid();
            }
            else{
                layer_alert("审核错误", "error");
            }
        }, "json");
    }

    function initZtree(){
        var setting = {
            data: {
                simpleData: {
                    enable: true
                }
            },
            callback: {
                beforeClick: zTreeBeforeClick
            }
        };
        $.post("${basePath}/cache/roleTreeList", function(data){
            if(data.code===0){
                $.fn.zTree.init($("#zTree"), setting, data.data);
            }
            else{
                layer_alert("数据加载失败", "error");
            }
        }, "json");
    }

    function zTreeBeforeClick(treeId, treeNode, clickFlag) {
        var id=treeNode.id;
        if(id==""){
            exwhere="";
            searchGrid();
            return;
        }
        else{
            exwhere="{\"pId_equal\":\""+id+"\",\"or_id_equal\":\""+id+"\"}";
            searchGrid();
        }

    }
</script>


<!-- 配置grid -->
<div class="row">
    <div class="col-sm-3">
        <div class="widget-box widget-color-blue2">
            <div class="widget-header">
                <h4 class="widget-title lighter smaller">角色组织架构</h4>
            </div>

            <div class="widget-body">
                <div class="widget-main padding-8">
                    <ul id="zTree" class="ztree"></ul>
                </div>
            </div>
        </div>
    </div>


    <div class="col-xs-9 tb-grid">
        <!-- 配置查询 -->
        @ var _col1=[
        @			  {name:"审核状态",index:"a_status", type:"select_911"}
        @		   ];
        @ include("/common/_function/_search_double_page.html",{"_col":_col1}){}
        <div class="welljq well-sm" id="columns">
            <input type="checkbox" value="avater" class="cbox" checked="checked" disabled="disabled"/>头像
            <input type="checkbox" value="idcard" class="cbox" checked="checked"/>组织ID
            <input type="checkbox" value="gName" class="cbox" checked="checked"/>名称
            <input type="checkbox" value="targat" class="cbox" checked="checked"/>组织关键字
            <input type="checkbox" value="createName" class="cbox" checked="checked"/>创建者
            <input type="checkbox" value="approvalName" class="cbox" checked="checked"/>审核者
            <input type="checkbox" value="auditStatus" class="cbox" checked="checked"/>审核状态
            <input type="checkbox" value="auditComment" class="cbox" checked="checked"/>备注
            <input type="checkbox" value="updateTime" class="cbox" checked="checked"/>状态改变时间
        </div>
        <!-- grid -->
        <table id="grid-table1"></table>
        <!-- 分页 -->
        <div id="grid-pager1"></div>
    </div>
</div>

<!-- 引入列表页所需js -->
@include("/common/_listscript.html"){}
<link rel="stylesheet" href="${basePath}/static/zTree/css/zTreeStyle/zTreeStyle.css" />
<script src="${basePath}/static/zTree/js/jquery.ztree.core.js" type="text/javascript" ></script>
@}	