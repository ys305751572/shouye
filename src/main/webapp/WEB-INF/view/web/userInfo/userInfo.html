<!-- 
 * Generated by Blade.
 * 2016-06-13 10:43:54
 -->
@layout("/common/_curd/_container.html"){

<script type="text/javascript">
	var ctx = "${basePath}";
	var grid_selector = "#grid-table";
	var pager_selector = "#grid-pager";
	
	$(function(){
		initGrid();
		initMenuBtn("btns", "${code}");
	});
	
	function initGrid(){
		var grid_url = ctx + "/${code}/list";
		var _colnames = [
				"id",
				"userId",
				"头像",
				"账号ID",
				"名字",
				"性别",
				"年龄",
				"地区",
				"毕业院校",
				"事业状态",
				"行业领域",
				"职业",
				"专业",
				"擅长",
				"资历",
				"资源",
				"单位名称",
				"单位类型",
				"产品服务",
				"行业地位",
				"资质",
				"个人关键字",
				"所属组织",
				"会员类型",
				"已加入组织数量",
				"朋友数量",
				"熟人数量",
				"活动报名数",
				"活动签名数",
				"活动参与率",
				"内容发布数",
				"历史消费",
				"电话",
				"注册时间",
				"上次登录",
				"账号状态",
				"操作"
			];
		var _colmodel = [
			{name:"id",index:"id", width:80,hidden:true},
			{name:"userId",index:"userId", width:80,hidden:true},
			{name:"avater",index:"avater", width:120},
			{name:"accountId", index:"accountId", width:120},
			{name:"userName", index:"userName", width:120},
			{name:"gender", index:"gender", width:120,
				formatter: function (cellvalue, options, rowObject) {
					if(cellvalue == 1 ){
						return "男";
					}else{
						return "女";
					}
				}
			},
			{name:"age", index:"age", width:120},
			{name:"provinceCity", index:"provinceCity", width:120},
			{name:"school", index:"school", width:120},
			{name:"career", index:"career", width:120},
			{name:"domain", index:"domain", width:120},
			{name:"professional", index:"professional", width:120},
			{name:"proficient", index:"proficient", width:120},
			{name:"adept", index:"adept", width:120},
			{name:"seniority", index:"seniority", width:120},
			{name:"resources", index:"resources", width:120},
			{name:"organization", index:"organization", width:120},
			{name:"orgType", index:"orgType", width:120},
			{name:"productType", index:"productType", width:120,
				formatter: function (cellvalue, options, rowObject) {
					if(cellvalue == 1 ){
						return "服务";
					}else{
						return "产品";
					}
				}
			},
			{name:"industryRanking", index:"industryRanking", width:120},
			{name:"qualification", index:"qualification", width:120},
			{name:"keyWord", index:"keyWord", width:120},
			{name:"groupName", index:"groupName", width:120},
			{name:"vipType", index:"vipType", width:120,
				formatter: function (cellvalue, options, rowObject) {
					if(cellvalue == 1 ){
						return "会员";
					}else{
						return "干事";
					}
				}
			},
			{name:"organizationNum", index:"organizationNum", width:120},
			{name:"friendNum", index:"friendNum", width:120},
			{name:"acquaintancesNum", index:"acquaintancesNum", width:120},
			{name:"activityApplyNum", index:"activityApplyNum", width:120},
			{name:"activitySignNum", index:"activitySignNum", width:120},
			{name:"activityParticipate", index:"activityParticipate", width:120},
			{name:"contentNum", index:"contentNum", width:120},
			{formatter: function(cellvalue, options, rowObject) {return "暂无字段"}},
			{name:"mobile", index:"mobile", width:120},
			{name:"createTime", index:"createTime", width:120,
				formatter: function(cellvalue, options, rowObject) {
					if(cellvalue=='' || cellvalue==null || cellvalue=='undefind'){
						return "";
					}else {
						return date_format(cellvalue)
					}

				}
			},
			{name:"lastLoginTime", index:"lastLoginTime", width:120,
				formatter: function(cellvalue, options, rowObject) {
					if(cellvalue=='' || cellvalue==null || cellvalue=='undefind'){
						return "";
					}else {
						return date_format(cellvalue)
					}

				}
			},
			{name:"status", index:"status", width:120,
				formatter: function(cellvalue, options, rowObject) {
					if(cellvalue==1 ){
						return "<p style='color: black'>正常</p>"
					}else if(cellvalue==2){
						return "<p style='color: red'>封号</p>"
					}else {
						return "<p style='color: #b3b8b8'>冻结</p>"
					}
				}
			},
			{
				width: 300,
				formatter: function (cellvalue, options, rowObject) {
					var id = rowObject.userId;
					var status = rowObject.status;
					var userName = rowObject.userName;

					var departure = "<button title='封号' class='btn btn-primary btn-circle edit' data-toggle='modal' data-target='banned' onclick=\"banned(\'" + id + "\',\'" + userName + "\',\'" + status + "\',\'" + 2 + "\')\">" +
							"<i class='fa fa-circle-o'></i> 封号</button>";

					var freeze = "<button title='冻结' class='btn btn-primary btn-circle edit' data-toggle='modal' data-target='banned' onclick=\"banned(\'" + id + "\',\'" + userName + "\',\'" + status + "\',\'" + 3 + "\')\">" +
							"<i class='fa fa-circle-o'></i> 冻结</button>";

					var enterprise = "<button title='解封' class='btn btn-primary btn-circle edit' onclick=\"banned(\'" + id + "\',\'" + userName + "\',\'" + status + "\',\'" + 1 + "\')\">" +
							"<i class='fa fa-circle'></i> 解封</button>";

					if (status == "1") {
						return departure + "&nbsp;" + freeze;
					} else {
						return enterprise;
					}
				}
			}
		];
		
		jQuery(grid_selector).jqGrid({
			url : grid_url,
			colNames : _colnames,
			colModel : _colmodel, 
			jsonReader : {id :"id"},
			pager : pager_selector,
			postData : {sort : "id", order : "desc"}
		});
	}

	function date_format(data){
		var d = new Date(data);    //根据时间戳生成的时间对象

		var date = (d.getFullYear()) + "-" +
				(d.getMonth() + 1) + "-" +
				(d.getDate()) + " " +
				(d.getHours()) + ":" +
				(d.getMinutes()) + ":" +
				(d.getSeconds());
		return date;
	}

	function banned(id,name,status,index){
		//封号
		if(status == 1){
			var title = "";
			if(index == 2) {
				title = "封号处理";
			}else {
				title = "冻结处理";
			}
			layer.open({
				type: 2,
				title: title,
				area: ['800px', '550px'],
				content: '${basePath}/userInfo/banned?id=' + id +'&status=' + index //iframe的url
			});
		}else {
			var string = "";
			if(status==2){
				string = "确定解除【"+name+"】的封号状态？"
			}else {
				string = "确定解除【"+name+"】的冻结状态？"
			}

			//询问框
			layer.confirm(string, {
				btn: ['确定','取消'] //按钮
			}, function(){
				$.post(
					"${basePath}/userInfo/setBanned",
					{id:id,status:index},
					function (data){
						if(data.code===0){
							$jqGrid.jqGrid("setGridParam").trigger("reloadGrid");
							layer.msg('成功', {
								time: 1000 //1s后自动关闭
							});
						}else {
							layer.msg('错误', {
								time: 1000
							});
						}
					}, "json"
				);
			});
		}
	}

</script>


	<!-- 配置 grid -->
	<div class="row">
		<div class="col-xs-12 tb-grid">
			<!-- 配置 查询 -->
			@ var _col=[
			@	{name:"性别",index:"gender", type:"select_101"},
			@	{name:"年龄",index:"ageId", type:"select_904"},
			@	{name:"事业状态",index:"careerId", type:"selectId_905"},
			@	{name:"行业",index:"domainId", type:"select1_906"},
			@	{name:"组织类型",index:"groupType", type:"select_908"},
			@	{name:"产品服务",index:"productType", type:"select_912"},
			@	{name:"有无组织",index:"groupStatus", type:"select_916"},
			@	{name:"会员类型",index:"vipType", type:"select_914"},
			@	{name:"账号状态",index:"status", type:"select_915"}
			@	];
			@ include("/common/_function/_search.html",{"col":_col}){}
			<!-- 按钮 -->
			<div class="welljq well-sm" id="btns"></div>
			<div class="welljq well-sm" id="columns">
				<input type="checkbox" value="avater" class="cbox" checked="checked"  />头像
				<input type="checkbox" value="accountId" class="cbox" checked="checked"  />账号ID
				<input type="checkbox" value="userName" class="cbox" checked="checked"  />名字
				<input type="checkbox" value="gender" class="cbox" checked="checked"  />性别
				<input type="checkbox" value="age" class="cbox" checked="checked"  />年龄
				<input type="checkbox" value="provinceCity" class="cbox" checked="checked"  />省市
				<input type="checkbox" value="school" class="cbox" checked="checked"  />毕业院校
				<input type="checkbox" value="career" class="cbox" checked="checked"  />事业状态
				<input type="checkbox" value="domain" class="cbox" checked="checked"  />行业领域
				<input type="checkbox" value="professional" class="cbox" checked="checked"  />职业
				<input type="checkbox" value="proficient" class="cbox" checked="checked"  />专业
				<input type="checkbox" value="adept" class="cbox" checked="checked"  />擅长
				<input type="checkbox" value="seniority" class="cbox" checked="checked" />资历
				<input type="checkbox" value="resources" class="cbox" checked="checked" />资源
				<input type="checkbox" value="organization" class="cbox" checked="checked" />单位名称
				<input type="checkbox" value="orgType" class="cbox" checked="checked" />单位类型
				<input type="checkbox" value="productType" class="cbox" checked="checked"  />产品服务
				<input type="checkbox" value="industryRanking" class="cbox" checked="checked"  />行业地位
				<input type="checkbox" value="qualification" class="cbox" checked="checked"  />资质
				<input type="checkbox" value="keyWord" class="cbox" checked="checked"  />个人关键字
				<input type="checkbox" value="groupName" class="cbox" checked="checked"  />所属组织
				<input type="checkbox" value="vipType" class="cbox" checked="checked"  />会员类型
				<input type="checkbox" value="organizationNum" class="cbox" checked="checked"  />已加入组织数量
				<input type="checkbox" value="friendNum" class="cbox" checked="checked"  />朋友数量
				<input type="checkbox" value="acquaintancesNum" class="cbox" checked="checked"  />熟人数量
				<input type="checkbox" value="activityApplyNum" class="cbox" checked="checked"  />活动报名数
				<input type="checkbox" value="activitySignNum" class="cbox" checked="checked"  />活动签到数
				<input type="checkbox" value="activityParticipate" class="cbox" checked="checked"  />活动参与率
				<input type="checkbox" value="contentNum" class="cbox" checked="checked"  />内容发布数
				<input type="checkbox" value="mobile" class="cbox" checked="checked"  />电话
				<input type="checkbox" value="createTime" class="cbox" checked="checked"  />注册时间
				<input type="checkbox" value="lastLoginTime" class="cbox" checked="checked"  />最后登录时间
				<input type="checkbox" value="status" class="cbox" checked="checked"  />账号状态

			</div>
			<!-- grid -->
			<table id="grid-table"></table>
			<!-- 分页-->
			<div id="grid-pager"></div>
		</div>
	</div>
	
	<!-- 引入所需的js -->
	@include("/common/_listscript.html"){}
@}